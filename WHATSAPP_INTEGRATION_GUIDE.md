# WhatsApp Integration Guide for GenX Trading Platform

## Overview

This guide explains how to configure and use the WhatsApp notification system for the GenX Trading Platform. Trading signals and system notifications can be sent to WhatsApp groups to keep your trading team informed in real-time.

## Features

- ðŸ“± **Trading Signal Notifications**: Send AI-generated trading signals to WhatsApp groups
- ðŸ”” **System Alerts**: Receive system status updates and important notifications
- ðŸ“Š **Rich Formatting**: Messages include emojis and structured formatting for easy reading
- ðŸ”„ **Unified Integration**: Works seamlessly with Telegram and Discord bots through the unified notifier service

## Configuration

### 1. Set Up Environment Variable

Add the WhatsApp group URL to your `.env` file:

```bash
WHATSAPP_GROUP_URL=https://chat.whatsapp.com/DYemXrBnMD63K55bjUMKYF
```

**Where to find your WhatsApp group link:**
1. Open the WhatsApp group
2. Tap the group name at the top
3. Tap "Invite via link"
4. Copy the group invite link

### 2. Install Dependencies

The WhatsApp bot uses Python for message formatting and preparation:

```bash
pip install -r requirements.txt
```

## Usage

### Sending Trading Signals

```python
from services.whatsapp_bot import send_signal

# Prepare a trading signal
signal = {
    'symbol': 'XAUUSD',
    'action': 'BUY',
    'entry': 2650.50,
    'target': 2680.00,
    'stop_loss': 2630.00,
    'confidence': 85,
    'timestamp': '2024-01-04T10:30:00',
    'status': 'active'
}

# Send to WhatsApp
success = send_signal(signal)
```

### Sending Notifications

```python
from services.whatsapp_bot import send_notification

success = send_notification(
    title="System Alert",
    message="Trading system is now active and monitoring markets"
)
```

### Using the Unified Notifier

The unified notifier sends messages to all configured channels (Telegram, Discord, WhatsApp):

```python
from services.notifier import send_signal, send_notification

# Send signal to all channels
results = send_signal(signal)
# Returns: {'telegram': True, 'discord': True, 'whatsapp': True}

# Send notification to specific channels
results = send_notification(
    title="Alert",
    message="Important update",
    channels=['whatsapp', 'telegram']  # Optional: specific channels
)
```

## Message Format

Trading signals are formatted with emojis and clear structure:

```
ðŸŸ¢ *GenX FX Trading Signal* ðŸŸ¢

ðŸ“Š *Symbol:* XAUUSD
ðŸ“ˆ *Action:* BUY
ðŸ’° *Entry:* 2650.5
ðŸŽ¯ *Target:* 2680.0
ðŸ›¡ï¸ *Stop Loss:* 2630.0

â­â­â­â­ *Confidence:* 85%
â° *Time:* 2024-01-04T10:30:00

_Generated by GenX AI Trading Platform_
```

## Testing

Run the test suite to verify the integration:

```bash
python test_whatsapp_bot.py
```

The test suite will:
1. Test message formatting
2. Test signal sending
3. Test notification sending
4. Test status updates
5. Test unified notifier integration

## Production Deployment Options

### Current Implementation (Manual)

The current implementation prepares and logs messages that should be manually shared to the WhatsApp group. This is suitable for:
- Development and testing
- Low-volume notifications
- Manual oversight of all messages

### Automated Options

For fully automated WhatsApp messaging in production, consider:

#### 1. WhatsApp Business API (Recommended)
- **Official solution** from Meta
- Reliable and supported
- Requires business verification
- Costs apply based on volume
- [Get started](https://business.whatsapp.com/products/business-platform)

#### 2. Third-Party Services
- **Twilio**: [WhatsApp Business API integration](https://www.twilio.com/whatsapp)
- **MessageBird**: WhatsApp Business API provider
- **360dialog**: Official WhatsApp Business Solution Provider

#### 3. Browser Automation (Not Recommended)
- Uses Selenium or Puppeteer
- Violates WhatsApp Terms of Service
- Risk of account suspension
- Not reliable for production

### Implementing WhatsApp Business API

To upgrade to WhatsApp Business API:

1. **Register for WhatsApp Business API** through an official provider
2. **Update `services/whatsapp_bot.py`** to use the API:
   ```python
   import requests
   
   def send_to_api(message: str):
       response = requests.post(
           'https://api.whatsapp.com/v1/messages',
           headers={'Authorization': f'Bearer {API_TOKEN}'},
           json={
               'to': GROUP_ID,
               'text': {'body': message}
           }
       )
       return response.status_code == 200
   ```
3. **Update environment variables**:
   ```bash
   WHATSAPP_API_TOKEN=your_token_here
   WHATSAPP_GROUP_ID=your_group_id
   ```

## Integration with Trading System

### Automatic Signal Distribution

The WhatsApp bot is integrated with the main trading engine. Signals are automatically sent when generated:

```python
# In core/strategies/signal_analyzer.py
from services.notifier import send_signal

# After generating a signal
signal = generate_trading_signal()
send_signal(signal)  # Sends to all configured channels
```

### System Monitoring

Status updates can be sent automatically:

```python
from services.notifier import send_status_update

send_status_update(
    service_name="AI Signal Generator",
    status="online",
    details="All models operational"
)
```

## Troubleshooting

### Bot Not Sending Messages

1. **Check environment variable**: Ensure `WHATSAPP_GROUP_URL` is set in `.env`
2. **Check logs**: Look for warning messages in the application logs
3. **Verify group URL**: Ensure the WhatsApp group invite link is valid

### Messages Not Appearing in Group

- The current implementation requires manual sharing
- For automated messaging, upgrade to WhatsApp Business API
- Check that you have access to the WhatsApp group

### Integration Issues

1. **Test individual components**:
   ```bash
   python test_whatsapp_bot.py
   ```
2. **Check service imports**:
   ```python
   from services.whatsapp_bot import whatsapp_bot
   print(whatsapp_bot.enabled)  # Should be True
   ```

## Security Considerations

- **Never commit** API tokens or sensitive credentials to version control
- Use **environment variables** for all secrets
- **Restrict group access** to authorized team members only
- **Monitor message content** to avoid leaking sensitive trading data
- **Use encryption** when storing API credentials

## API Reference

### WhatsAppBot Class

```python
class WhatsAppBot:
    def __init__(self):
        """Initialize with WHATSAPP_GROUP_URL from environment"""
        
    def send_signal(self, signal: Dict) -> bool:
        """Send a trading signal"""
        
    def send_notification(self, title: str, message: str) -> bool:
        """Send a general notification"""
        
    def send_status_update(self, service_name: str, status: str, details: str = "") -> bool:
        """Send a service status update"""
        
    def format_signal_message(self, signal: Dict) -> str:
        """Format signal data into a readable message"""
```

## Support

For issues or questions:
1. Check the [main README](README.md)
2. Review the [deployment guide](DEPLOYMENT.md)
3. Open an issue on GitHub
4. Check WhatsApp Business API documentation

---

**Note**: This integration is part of the GenX Trading Platform's multi-channel notification system. Configure additional channels (Telegram, Discord) in `.env` for comprehensive coverage.
